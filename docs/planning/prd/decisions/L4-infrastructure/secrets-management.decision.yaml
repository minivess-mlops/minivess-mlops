decision_id: secrets_management
title: "Secrets Management"
description: >
  How API keys, database credentials, and other secrets are stored and
  accessed. Dotenv files are simplest for local development; HashiCorp
  Vault provides enterprise-grade secrets management; SOPS encrypts
  secrets in Git; none means hardcoded or environment-only.

decision_level: L4_infrastructure
status: active
last_updated: 2026-02-23

options:
  - option_id: dotenv
    title: "Dotenv Files"
    description: >
      .env files loaded via python-dotenv or Dynaconf. Simple, local-first
      approach. Currently implemented for Langfuse, MLflow, and other
      service credentials. Must be .gitignored.
    prior_probability: 0.35
    status: resolved
    implementation_status: implemented
    complements:
      - "containerization.docker_compose"
      - "compute_target.local_gpu"

  - option_id: vault
    title: "HashiCorp Vault"
    description: >
      Enterprise secrets management with dynamic secrets, audit logging,
      and fine-grained access control. Supports K8s integration and
      auto-rotation. Significant operational overhead.
    prior_probability: 0.25
    status: viable
    implementation_status: not_started
    constraints:
      - "Vault server deployment and management"
      - "PKI and unsealing complexity"
      - "Client library integration"
    complements:
      - "containerization.kubernetes"
      - "iac_tooling.terraform"

  - option_id: sops
    title: "SOPS Encrypted Secrets"
    description: >
      Mozilla SOPS encrypts secrets in-place within YAML/JSON files.
      Secrets can be committed to Git (encrypted). Supports age, GPG,
      and cloud KMS. Good for GitOps workflows.
    prior_probability: 0.20
    status: viable
    implementation_status: not_started
    complements:
      - "gitops_strategy.argocd"
      - "gitops_strategy.fluxcd"

  - option_id: none
    title: "No Secrets Management"
    description: >
      Environment variables only, no structured secrets management.
      Acceptable for fully local development with no external services.
    prior_probability: 0.20
    status: viable
    implementation_status: not_started

conditional_on:
  - parent_decision_id: compliance_depth
    influence_strength: moderate
    conditional_table:
      - given_parent_option: iec_62304_full
        then_probabilities:
          dotenv: 0.10
          vault: 0.50
          sops: 0.30
          none: 0.10
      - given_parent_option: lightweight_audit
        then_probabilities:
          dotenv: 0.40
          vault: 0.20
          sops: 0.25
          none: 0.15
      - given_parent_option: no_compliance
        then_probabilities:
          dotenv: 0.35
          vault: 0.10
          sops: 0.15
          none: 0.40

archetype_weights:
  solo_researcher:
    probability_overrides:
      dotenv: 0.55
      vault: 0.05
      sops: 0.15
      none: 0.25
    rationale: "Solo researchers use .env files; no need for enterprise secrets management"
  lab_group:
    probability_overrides:
      dotenv: 0.25
      vault: 0.35
      sops: 0.25
      none: 0.15
    rationale: "Lab groups sharing infrastructure benefit from centralized secrets"
  clinical_deployment:
    probability_overrides:
      dotenv: 0.10
      vault: 0.45
      sops: 0.30
      none: 0.15
    rationale: "Clinical deployment requires auditable, rotatable secrets management"

volatility:
  classification: stable
  last_assessed: 2026-02-23
  next_review: 2026-08-23
  change_drivers:
    - "Cloud deployment requiring centralized secrets"
    - "Multi-developer team needing shared secrets"
    - "Compliance audit requiring secrets rotation"
    - "SOPS + age adoption in ML community"

domain_applicability:
  vascular_segmentation: 0.8
  cardiac_imaging: 0.9
  neuroimaging: 0.8
  general_medical: 1.0

rationale: >
  Dotenv (0.35) is the resolved choice for local-first development,
  following security practices within MLOps architecture (Kreuzberger et al., 2023).
  Vault (0.25) becomes relevant when the project needs shared infrastructure
  or compliance, as recommended in CD4ML deployment patterns (Sato et al., 2019).

references:
  - citation_key: kreuzberger2023mlops
    relevance: "MLOps architecture survey covering security components including secrets management"
    supports_options:
      - dotenv
      - vault
      - sops
  - citation_key: sato2019cd4ml
    relevance: "CD4ML patterns addressing secret handling in deployment pipelines"
    supports_options:
      - vault
      - sops

tags:
  - infrastructure
  - security
  - secrets
  - resolved
