name: Test (Dataload)

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: checkout repo content
        uses: actions/checkout@v2 # checkout the repository content
      - name: dockerhub login
        env:
          DOCKERHUB_USER: ${{secrets.DOCKERHUB_USERNAME}}
          DOCKERHUB_PASSWORD: ${{secrets.DOCKERHUB_PASSWORD}}
        run:
          docker login -u $DOCKERHUB_USER -p $DOCKERHUB_PASSWORD
      - name: pull Docker image
        run: docker pull petteriteikari/minivess-mlops:latest
#      - name: Configure AWS credentials
#        uses: aws-actions/configure-aws-credentials@v1
#        with:
#          aws-access-key-id: ${{secrets.AWS_ACCESS_KEY_ID}}
#          aws-secret-access-key: ${{secrets.AWS_SECRET_ACCESS_KEY}}
      - name: Execute "run_training.py" for testing data loading
        env:
          MLFLOW_USER: ${{secrets.MLFLOW_USERNAME}}
          MLFLOW_PASSWORD: ${{secrets.MLFLOW_PASSWORD}}
        run: >
          docker run --rm petteriteikari/minivess-mlops:latest 
          python run_training.py 
          -c task_config.yaml -run test_dataload # Input arguments

